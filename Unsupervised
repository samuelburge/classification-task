#Dimension of data (1000x784)
dim(y)
# Calculate column means
apply(y, 2, mean) 
# Calculate column variance
apply(y, 2, var)

#Perform PCA
pca.out=prcomp(y, scale=TRUE)
# 784 principal components
pca.out
# Biplot
biplot(pca.out, scale=0)

#Proportion of variance explained
pca.out$sdev
pr.var=pca.out$sdev^2
pr.var
pve=pr.var/sum(pr.var)
pve

# Create plot of PVE 
plot(pve, xlab="Principal Component", ylab="Proportion of Variance Explained", ylim=c(0,1), type='b')
# Create cumulative PVE to find the elbow or cut-off threshold
plot(cumsum(pve), xlab="Principal Component", ylab="Cumulative Proportio plained", ylim=c(0,1), type='b')
cumsum(pve)




# Optimal k using Total Within Sum of Squares (elbow plot)
install.packages("factoextra")
library(factoextra)
fviz_nbclust(y, kmeans, method = "wss")
# Optimal 7 clusters

#calculate gap statistic based on number of clusters
gap_stat <- clusGap(y,
                    FUN = kmeans,
                    nstart = 25,
                    K.max = 100,
                    B = 50)

fviz_gap_stat(gap_stat)


# Plot
km7 <- kmeans(y, centers = 7, nstart = 25)
fviz_cluster(km7, data = y)
km7
